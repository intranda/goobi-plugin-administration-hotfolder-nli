<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:composite="http://xmlns.jcp.org/jsf/composite"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:jsf="http://xmlns.jcp.org/jsf"
	xmlns:x="http://myfaces.apache.org/tomahawk"
	xmlns:intranda="http://xmlns.jcp.org/jsf/composite/composites"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:p="http://primefaces.org/ui">

	<composite:interface>
	</composite:interface>

	<composite:implementation>

		<h:panelGroup>
			<div class="row">
				<div class="col-sm-12">
					<div class="box box-color box-bordered lightgrey">
						<div class="box-title">
							<h3>
								<i class="fa fa-plug"></i>
								<h:outputText
									value="#{msgs[AdministrationForm.administrationPlugin.title]}" />
							</h3>
						</div>
						<div class="box-content">

							<h:panelGroup
								rendered="#{!LoginForm.hasRole('Plugin_administration_hotfolder_nli')}">
								<h:outputText
									styleClass="alert alert-danger alert-dismissable margin-bottom-10 margin-top-10"
									value="#{msgs.plugin_administration_missingPermission} Plugin_administration_hotfolder_nli"></h:outputText>
							</h:panelGroup>

							<h:panelGroup id="actionform" styleClass="col-sm-12"
								rendered="#{LoginForm.hasRole('Plugin_administration_hotfolder_nli')}">
								<div class="row">
									<h:form>
                                        <ui:fragment rendered="#{AdministrationForm.administrationPlugin.paused}">
                                            <div class="alert alert-warning clearfix">
                                             <i class="fa fa-pause fa-5x pull-left"></i>
                                                <h4>
                                                  #{msgs.plugin_NliHotfolder_hotfolderpaused}
                                                </h4>
                                            </div>
                                            <button class="btn" jsf:action="#{AdministrationForm.administrationPlugin.resumeWork}">
                                                #{msgs.plugin_NliHotfolder_resumework}
                                            </button>
                                        </ui:fragment>
                                        <ui:fragment rendered="#{not AdministrationForm.administrationPlugin.paused}">
                                            <h:panelGroup styleClass="alert alert-success clearfix" rendered="#{AdministrationForm.administrationPlugin.running}" layout="block">
                                                <i class="fa fa-play fa-5x pull-left"></i>
                                                <h4>#{msgs.plugin_NliHotfolder_importing}</h4>
                                                <strong>#{msgs.plugin_NliHotfolder_importstartedat}: </strong> 
                                                <h:outputText value="#{AdministrationForm.administrationPlugin.startedRunningAt}">
                                                    <f:convertDateTime dateStyle="full" pattern="yyyy-MM-dd HH:mm:ss z"/>
                                                </h:outputText>
                                                <br />
                                                <strong>#{msgs.plugin_NliHotfolder_currentimportrunningtime}: </strong> #{AdministrationForm.administrationPlugin.runningSince}
                                            </h:panelGroup>
                                            <h:panelGroup styleClass="alert alert-info clearfix" rendered="#{not AdministrationForm.administrationPlugin.running}" layout="block">
                                                <i class="fa fa-clock-o fa-5x pull-left"></i>
                                                <h4>
                                                    #{msgs.plugin_NliHotfolder_waiting}
                                                </h4>
                                            </h:panelGroup>
                                            <button class="btn" jsf:action="#{AdministrationForm.administrationPlugin.pauseWork}">
                                                #{msgs.plugin_NliHotfolder_pausework}
                                            </button>
                                        </ui:fragment>
                                        
                                        
									</h:form>
								</div>
							</h:panelGroup>

						</div>
					</div>
                    
                    
                    <div class="box box-color box-bordered blue" jsf:id="runInfoBox" jsf:rendered="#{LoginForm.hasRole('Plugin_administration_hotfolder_nli')}">
                        <div class="box-title">
                            <h3>
                                <i class="fa fa-plug"></i>
                                <h:outputText value="Last run info" />
                            </h3>
                        </div>
                        <div class="box-content">
	                        
	                        <span>
					            <button 
									jsf:action="#{AdministrationForm.administrationPlugin.previousLog}"
									jsf:id="previousLogButton" 
									class="btn btn-primary font-size-s">
									<i class="fa fa-angle-left"></i>
									<h:outputText value=" #{msgs.lw_previousImage}" />
									<f:ajax execute="@form" render="runInfoBox" />
								</button>	
							</span>

                            <span>
								<button 
									jsf:action="#{AdministrationForm.administrationPlugin.nextLog}"
									jsf:id="nextLogButton" 
									class="btn btn-primary font-size-s">
									<h:outputText value="#{msgs.lw_nextImage} " />
									<i class="fa fa-angle-right"></i>
									<f:ajax execute="@form" render="runInfoBox" />
								</button>
							</span>
							
							<span>
							    <h:outputText value="#{AdministrationForm.administrationPlugin.orderOfRunInfo} " />
							</span>
		
							<hr />
                        
                            <ui:repeat var="folder" value="#{AdministrationForm.administrationPlugin.lastRunInfo.keySet()}">
                                <!-- Template name / Hotfolder name and the button to show / hide logs from previous runs -->
	                            <div>
	                                <h4 style="display: inline;">#{folder}</h4>                         
	                                <button class="btn pull-right" jsf:action="#{AdministrationForm.administrationPlugin.toggleShowFolder(folder)}">
	                                    <h:outputText value="#{AdministrationForm.administrationPlugin.showFolders[folder] ? 'Hide' : 'Show'}" />
	                                    <f:ajax render="runInfoBox" />
	                                </button>
	                            </div>
	                            <!-- // Template name / Hotfolder name and button -->
	                            <hr />
	                            <!-- Table of error logs from the last run -->                            
	                            <table class="table table-bordered table-hover" jsf:rendered="#{AdministrationForm.administrationPlugin.showFolders[folder]}">
	                                <thead>
	                                    <tr>
	                                        <th>Process</th>
	                                        <th>Result</th>
	                                    </tr>
	                                </thead>
	                                <tbody>
	                                    <ui:repeat var="io" value="#{AdministrationForm.administrationPlugin.lastRunInfo[folder]}">
	                                    <tr>
	                                        <td>#{io.importFileName}</td>
	                                        <td>#{empty io.errorMessage ? 'OK' : io.errorMessage}</td>
	                                    </tr>
	                                    </ui:repeat>
	                                </tbody>
	                            </table>	                            
	                            <!-- // Table -->
	                            
                            </ui:repeat>
                            
                        </div>
                    </div>
				</div>
			</div>
		</h:panelGroup>

	</composite:implementation>
</ui:composition>
